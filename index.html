<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Timer Code Game</title>

<style>
  body {
    font-family: Arial, sans-serif;
    text-align: center;
    margin-top: 50px;
  }

  /* HUGE RED TIMER */
  #timer {
    font-size: 20rem;        /* HUGE */
    font-weight: 900;       /* extra bold */
    color: red;             /* RED */
    margin-bottom: 30px;
    text-shadow: 4px 4px 10px rgba(0,0,0,0.4);
  }

  #message {
    margin-top: 10px;
    height: 20px;
    font-weight: bold;
  }

  input[type="text"] {
    padding: 10px;
    font-size: 1.2rem;
    width: 160px;
    text-transform: uppercase;
  }

  button {
    padding: 12px 22px;
    font-size: 1.1rem;
    margin-top: 10px;
    cursor: pointer;
  }
</style>
</head>
<body>

  <div id="timer">30:00</div>
  <audio id="successSound" src="sucess.mp3" preload="auto"></audio>
  <audio id="failureSound" src="failure.mp3" preload="auto"></audio>
  <audio id="messageBeep" src="beep.mp3" preload="auto"></audio>
  <button id="startBtn">Start the Escape Room</button>

  <br><br>

  <!-- Code input -->
  <input
    id="answerInput"
    type="text"
    placeholder="Enter Code"
    maxlength="3"
    disabled
  />
  <button id="submitBtn" disabled>Enter</button>

  <div id="message"></div>
  <div id="liveMessage" style="margin-top:30px; font-size:4rem; font-weight:bold;"></div>
  <script>
    // ===== SETTINGS =====
    const START_MINUTES = 30;
    const BONUS_MINUTES = 5;

    // CODES for time
    const VALID_CODES = [
      "A1B",
      "C3D",
      "X9Z",
      "4QW",
      "M7N",
      "P2K",
      "L8R",
      "T5Y",
      "B6C",
      "H2J",
      "R4S",
      "Z0X",
      "067",
      "AB9",
      "DVT"
    ];

    let remainingSeconds = START_MINUTES * 60;
    let intervalId = null;
    let usedCodes = [];

    const timerEl = document.getElementById("timer");
    const inputEl = document.getElementById("answerInput");
    const messageEl = document.getElementById("message");
    const startBtn = document.getElementById("startBtn");
    const submitBtn = document.getElementById("submitBtn");

    // ===== RESTORE TIMER FROM LOCAL STORAGE =====
    function loadTimer() {
      const saved = localStorage.getItem("remainingSeconds");
      const lastUpdate = localStorage.getItem("lastTimestamp");

      if (saved && lastUpdate) {
        const secondsPassed = Math.floor((Date.now() - Number(lastUpdate)) / 1000);
        remainingSeconds = Math.max(0, Number(saved) - secondsPassed);
      } else {
        remainingSeconds = START_MINUTES * 60;
      }

      updateTimerDisplay();
    }

    // ===== SAVE TIMER TO LOCAL STORAGE =====
    function saveTimer() {
      localStorage.setItem("remainingSeconds", remainingSeconds);
      localStorage.setItem("lastTimestamp", Date.now());
    }

    // ===== UPDATE DISPLAY =====
    function updateTimerDisplay() {
      const minutes = Math.floor(remainingSeconds / 60);
      const seconds = remainingSeconds % 60;

      timerEl.textContent =
        String(minutes).padStart(2, "0") + ":" + String(seconds).padStart(2, "0");
    }

    // ===== LOAD USED CODES =====
    function loadUsedCodes() {
      const savedCodes = localStorage.getItem("usedCodes");
      if (savedCodes) {
        try {
          usedCodes = JSON.parse(savedCodes);
        } catch {
          usedCodes = [];
        }
      } else {
        usedCodes = [];
      }
    }

    // ===== SAVE USED CODES =====
    function saveUsedCodes() {
      localStorage.setItem("usedCodes", JSON.stringify(usedCodes));
    }

    // ===== START TIMER =====
    function startTimer() {
      if (intervalId) return;

      intervalId = setInterval(() => {
        if (remainingSeconds <= 0) {
          remainingSeconds = 0;
          updateTimerDisplay();
          messageEl.textContent = "Time is up!";
          clearInterval(intervalId);
          return;
        }

        remainingSeconds--;
        updateTimerDisplay();
        saveTimer();
      }, 1000);
    }

    // ===== CHECK CODE =====
    function checkCode() {
      let code = inputEl.value.trim().toUpperCase();
      // =====================
      // SECRET RESET CODE
      // =====================
      if (code === "RES") {

          // Reset timer
          remainingSeconds = START_MINUTES * 60;
          saveTimer();
          updateTimerDisplay();
      
          // Reset used codes
          usedCodes = [];
          saveUsedCodes();
      
          // Reset game start state
          localStorage.removeItem("gameStarted");
      
          // Show start button again
          startBtn.style.display = "inline-block";
      
          // Disable input fields until Start is pressed
          inputEl.disabled = true;
          submitBtn.disabled = true;
      
          // Stop the timer
          if (intervalId) clearInterval(intervalId);
          intervalId = null;
      
          messageEl.textContent = "Game has been reset.";
      
          inputEl.value = "";
          return;
      }

      if (!code) {
        messageEl.textContent = "Please enter a code.";
        return;
      }

      if (code.length !== 3) {
        messageEl.textContent = "Code must be 3 characters.";
        return;
      }

      // Valid code?
      if (!VALID_CODES.includes(code)) {
        messageEl.textContent = "Invalid code.";
        remainingSeconds -= 10;
        document.getElementById("failureSound").play();
        inputEl.value = "";
        inputEl.focus();
        return;
      }

      // Already used?
      if (usedCodes.includes(code)) {
        messageEl.textContent = "This code has already been used.";
        inputEl.value = "";
        inputEl.focus();
        return;
      }

      // Correct & unused code
      usedCodes.push(code);
      saveUsedCodes();

      remainingSeconds += BONUS_MINUTES * 60;
      updateTimerDisplay();
      saveTimer();

      messageEl.textContent = `Code accepted! +${BONUS_MINUTES} minutes added.`;
      document.getElementById("successSound").play();
      inputEl.value = "";
      inputEl.focus();
    }

    // ===== START BUTTON CLICK =====
    startBtn.addEventListener("click", () => {
      startTimer();
      saveTimer();

      inputEl.disabled = false;
      submitBtn.disabled = false;

      startBtn.style.display = "none";
      localStorage.setItem("gameStarted", "true");
    });

    // ===== RESTORE GAME STATE ON LOAD =====
    loadUsedCodes();
    loadTimer();

    if (localStorage.getItem("gameStarted") === "true") {
      startBtn.style.display = "none";
      inputEl.disabled = false;
      submitBtn.disabled = false;
      startTimer();
    }

    submitBtn.addEventListener("click", checkCode);
    inputEl.addEventListener("keyup", (event) => {
      if (event.key === "Enter") checkCode();
    });

    updateTimerDisplay();
    // ===== DYNAMIC LIVE MESSAGE FROM message.txt =====
    const liveMessageEl = document.getElementById("liveMessage");
    const MESSAGE_URL = window.location.origin + "/message.txt"; // e.g. https://sumits20.github.io/message.txt
    const MESSAGE_POLL_INTERVAL_MS = 2000; // 2 seconds
    let lastMessageText = null;

    const messageBeepEl = document.getElementById("messageBeep");

  function fetchLiveMessage() {
  if (!liveMessageEl) return;

  try {
    var xhr = new XMLHttpRequest();
    xhr.open("GET", MESSAGE_URL + "?t=" + Date.now(), true); // ?t= to bypass cache

    xhr.onreadystatechange = function () {
      if (xhr.readyState === 4) {
        if (xhr.status === 200) {
          var text = xhr.responseText.trim();

          if (text !== lastMessageText) {
            lastMessageText = text;
            liveMessageEl.textContent = text;

            if (messageBeepEl) {
              try {
                messageBeepEl.currentTime = 0; // restart from beginning
                messageBeepEl.play();
              } catch (e) {
                // ignore if autoplay blocked
              }
            }
          }
        } else {
          // Optional: you could log or show an error if needed
          // console.warn("Failed to fetch live message:", xhr.status);
        }
      }
    };

    xhr.send();
  } catch (err) {
    // Optional: log if you test on desktop
    // console.error("Error fetching live message:", err);
  }
}

    
    // Start polling after page load
    fetchLiveMessage(); // initial load
    setInterval(fetchLiveMessage, MESSAGE_POLL_INTERVAL_MS);


    
  </script>

</body>
</html>






















